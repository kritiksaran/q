<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>Form Keluh Kesah</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  font-family:system-ui;
  background:linear-gradient(180deg,#eef2f7,#f8fafc);
  padding:20px;
}

.container{
  max-width:520px;
  margin:auto;
  background:#fff;
  padding:22px;
  border-radius:16px;
  box-shadow:0 12px 40px rgba(0,0,0,.08);
}

h2{text-align:center;margin:0 0 16px}

input, select, button{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid #d1d5db;
  margin-bottom:12px;
  font-size:14px;
  box-sizing:border-box; /* üîë FIX */
}


button{
  background:#22c55e;
  color:#fff;
  border:none;
  font-weight:600;
  cursor:pointer;
}
button:hover{opacity:.9}
button:disabled{opacity:.6}

#notif{
  display:none;
  padding:10px;
  border-radius:8px;
  font-size:14px;
  text-align:center;
  margin-top:6px;
}
#notif.loading{background:#e0f2fe;color:#0369a1}
#notif.success{background:#dcfce7;color:#166534}
#notif.error{background:#fee2e2;color:#991b1b}

.item{
  background:#f9fafb;
  padding:14px 16px;
  border-radius:12px;
  border-left:5px solid #2563eb;
  margin-bottom:14px;
}

.date{
  font-size:12px;
  color:#6b7280;
  margin-bottom:6px;
}

.pagination{
  display:flex;
  justify-content:center;
  gap:6px;
  margin-top:14px;
}
.pagination button{
  width:auto;
  padding:6px 12px;
  background:#e5e7eb;
  color:#111;
}
.pagination button.active{
  background:#2563eb;
  color:#fff;
}
</style>
</head>

<body>
<div class="container">

<h2>Keluh Kesah</h2>

<!-- FORM -->
<form id="form">
  <select id="dear" required>
    <option value="">Dear to</option>
    <option>Admin</option>
    <option>Editor</option>
  </select>

  <input id="keluh" placeholder="Tulis keluh kesah..." required>

  <button type="submit">Kirim</button>
  <div id="notif"></div>
</form>

<hr style="margin:20px 0">

<!-- OPEN DATA -->
<button id="openBtn">üîê Buka Keluh Kesah</button>

<div id="filterBox" style="display:none;margin-top:14px">
  <select id="filterDear">
    <option value="ALL">Semua Tujuan</option>
    <option value="Admin">Admin</option>
    <option value="Editor">Editor</option>
  </select>
</div>

<div id="list" style="margin-top:16px"></div>
<div class="pagination" id="pagination"></div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz1Bp1NBD4VI1ujBC2wZcwUfWhbhjmqKMIKDxCfuqfrZt_6qaxb6YWWdJemyus8nH7D/exec";

let data = [];
let page = 1;
const limit = 5;
let opened = false;
let sessionPassword = "";

/* =====================
   FORMAT TANGGAL
===================== */
function formatDateIndo(v){
  const d = new Date(v);
  const bulan = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
  return `${d.getDate()} ${bulan[d.getMonth()]} ${d.getFullYear()}`;
}

/* =====================
   LOAD DATA
===================== */
async function loadData(){
  try{
    const res = await fetch(API_URL + "?password=" + encodeURIComponent(sessionPassword));
    const text = await res.text();

    // PASSWORD SALAH
    if(text === "DENIED" || !text){
      alert("‚ùå Password salah");
      opened = false;
      sessionPassword = "";
      filterBox.style.display = "none";
      return;
    }

    const json = JSON.parse(text);
    data = json.slice(1).sort((a,b)=>new Date(b[0])-new Date(a[0]));
    render();
  }catch(e){
    alert("‚ùå Gagal memuat data");
    opened = false;
    sessionPassword = "";
  }
}

/* =====================
   RENDER
===================== */
function render(){
  list.innerHTML = "";

  let filtered = data;
  if(filterDear.value !== "ALL"){
    filtered = data.filter(r=>r[1]===filterDear.value);
  }

  const start = (page-1)*limit;
  const chunk = filtered.slice(start,start+limit);

  chunk.forEach(r=>{
    list.innerHTML += `
      <div class="item">
        <div class="date">${formatDateIndo(r[0])}</div>
        <b>To ${r[1]},</b>
        ${r[2]}
      </div>
    `;
  });

  renderPagination(filtered.length);
}

function renderPagination(total){
  pagination.innerHTML="";
  const pages = Math.ceil(total/limit);
  for(let i=1;i<=pages;i++){
    pagination.innerHTML+=`
      <button class="${i===page?'active':''}" onclick="go(${i})">${i}</button>
    `;
  }
}
function go(p){
  page=p;
  render();
}

/* =====================
   OPEN DATA
===================== */
openBtn.onclick = ()=>{
  if(opened) return;

  const pw = prompt("Masukkan password:");
  if(!pw) return;

  sessionPassword = pw;
  opened = true;
  filterBox.style.display = "block";
  loadData();
};

/* =====================
   FILTER
===================== */
filterDear.onchange = ()=>{
  page = 1;
  render();
};

/* =====================
   SUBMIT FORM
===================== */
form.onsubmit = async e=>{
  e.preventDefault();

  notif.style.display="block";
  notif.className="loading";
  notif.innerHTML="‚è≥ Mengirim data...";

  try{
    const res = await fetch(API_URL,{
      method:"POST",
      body:JSON.stringify({
        password: sessionPassword,
        date:new Date().toISOString(),
        dear:dear.value,
        keluh:keluh.value
      })
    });

    const text = await res.text();

    if(text === "OK"){
      notif.className="success";
      notif.innerHTML="‚úÖ Data berhasil dikirim";
      form.reset();

      if(opened) loadData();
      setTimeout(()=>notif.style.display="none",2500);
    }else{
      notif.style.display="none";
      alert("‚ùå Gagal mengirim data");
    }
  }catch{
    notif.style.display="none";
    alert("‚ùå Koneksi error");
  }
};
</script>


</body>
</html>
